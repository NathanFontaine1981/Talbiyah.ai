import { createClient } from '@supabase/supabase-js';

const supabase = createClient(
  'https://boyrjgivpepjiboekwuu.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJveXJqZ2l2cGVwamlib2Vrd3V1Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MTY4MjcwNywiZXhwIjoyMDc3MjU4NzA3fQ.8bjdYy46MPL58Z4l5yqW9WOEOMDoPU-BmqyZNdroZ_Q'
);

const insightId = 'def6b825-f0c2-4058-bbe9-1a72c1720b56';

const detailedContent = `## Lesson Summary

Today's lesson covered Surah An-Nazi'at (The Extractors), Chapter 79, Ayahs 1-33. This powerful Makkan surah opens with oaths about the angels who extract souls, then transitions to the story of Musa (AS) and Fir'awn, and concludes with descriptions of the Day of Resurrection and Allah's blessings upon mankind.

### Topics Covered
- The oaths of the angels and their duties
- The story of Musa (AS) confronting Fir'awn
- The Day of Resurrection (As-Sakhkhah)
- Allah's blessings: the earth, mountains, and provision

---

## Ayah Matching Quiz

Match the English meaning to the correct Arabic ayah:

**Question 1:** "By those [angels] who extract with violence"
- [ ] وَالسَّابِقَاتِ سَبْقًا
- [x] وَالنَّازِعَاتِ غَرْقًا
- [ ] وَالنَّاشِطَاتِ نَشْطًا
- [ ] فَالْمُدَبِّرَاتِ أَمْرًا

**Question 2:** "And by those who glide [as if] swimming"
- [ ] وَالنَّازِعَاتِ غَرْقًا
- [ ] فَالسَّابِحَاتِ سَبْحًا
- [x] فَالسَّابِحَاتِ سَبْحًا
- [ ] وَالنَّاشِطَاتِ نَشْطًا

**Question 3:** "Has there reached you the story of Musa?"
- [ ] إِذْ نَادَاهُ رَبُّهُ بِالْوَادِ الْمُقَدَّسِ طُوًى
- [x] هَلْ أَتَاكَ حَدِيثُ مُوسَىٰ
- [ ] اذْهَبْ إِلَىٰ فِرْعَوْنَ إِنَّهُ طَغَىٰ
- [ ] فَقُلْ هَل لَّكَ إِلَىٰ أَن تَزَكَّىٰ

**Question 4:** "Go to Fir'awn. Indeed, he has transgressed"
- [ ] هَلْ أَتَاكَ حَدِيثُ مُوسَىٰ
- [ ] فَقُلْ هَل لَّكَ إِلَىٰ أَن تَزَكَّىٰ
- [x] اذْهَبْ إِلَىٰ فِرْعَوْنَ إِنَّهُ طَغَىٰ
- [ ] وَأَهْدِيَكَ إِلَىٰ رَبِّكَ فَتَخْشَىٰ

**Question 5:** "As provision for you and your grazing livestock"
- [ ] وَالْجِبَالَ أَرْسَاهَا
- [ ] وَفَاكِهَةً وَأَبًّا
- [x] مَتَاعًا لَّكُمْ وَلِأَنْعَامِكُمْ
- [ ] وَالْأَرْضَ بَعْدَ ذَٰلِكَ دَحَاهَا

---

## Meaning & Tafsir

### Ayahs 1-5: The Oaths of the Angels

| Ayah | Arabic | Meaning | Tafsir |
|------|--------|---------|--------|
| 1 | وَالنَّازِعَاتِ غَرْقًا | By those who extract with violence | The angels who pull out the souls of the disbelievers harshly |
| 2 | وَالنَّاشِطَاتِ نَشْطًا | And those who remove with ease | The angels who gently take the souls of the believers |
| 3 | وَالسَّابِحَاتِ سَبْحًا | And those who glide swimming | Angels moving swiftly through the heavens |
| 4 | فَالسَّابِقَاتِ سَبْقًا | And those who race each other | Angels racing to fulfill Allah's commands |
| 5 | فَالْمُدَبِّرَاتِ أَمْرًا | And those who arrange affairs | Angels who manage the affairs by Allah's permission |

### Ayahs 6-14: The Day of Resurrection

**The Great Event (As-Sakhkhah)**
- يَوْمَ تَرْجُفُ الرَّاجِفَةُ - The Day when the earth will shake violently (first blow)
- تَتْبَعُهَا الرَّادِفَةُ - Followed by the subsequent one (second blow)
- قُلُوبٌ يَوْمَئِذٍ وَاجِفَةٌ - Hearts on that Day will tremble
- أَبْصَارُهَا خَاشِعَةٌ - Their eyes will be humbled

### Ayahs 15-26: The Story of Musa and Fir'awn

**Key Points:**
1. **Allah called Musa** at the sacred valley of Tuwa (طُوًى)
2. **The Command**: "Go to Fir'awn, for he has transgressed" (طَغَىٰ)
3. **The Invitation**: "Would you purify yourself?" (تَزَكَّىٰ)
4. **The Sign**: Musa showed him the great sign (الْآيَةَ الْكُبْرَىٰ)
5. **Fir'awn's Response**: He denied and disobeyed, then turned away striving
6. **His Arrogance**: "I am your lord, most high" (أَنَا رَبُّكُمُ الْأَعْلَىٰ)
7. **The Punishment**: Allah seized him with exemplary punishment

### Ayahs 27-33: Creation and Provision

**Allah's Rhetorical Question:**
> أَأَنتُمْ أَشَدُّ خَلْقًا أَمِ السَّمَاءُ ۚ بَنَاهَا
> "Are you more difficult to create, or the heaven? He constructed it."

**Allah's Blessings:**
- رَفَعَ سَمْكَهَا فَسَوَّاهَا - Raised its ceiling and proportioned it
- وَأَغْطَشَ لَيْلَهَا وَأَخْرَجَ ضُحَاهَا - Darkened its night and brought out its morning light
- وَالْأَرْضَ بَعْدَ ذَٰلِكَ دَحَاهَا - And the earth, He spread it out
- أَخْرَجَ مِنْهَا مَاءَهَا وَمَرْعَاهَا - Brought forth from it water and pasture
- وَالْجِبَالَ أَرْسَاهَا - And the mountains, He set firmly
- مَتَاعًا لَّكُمْ وَلِأَنْعَامِكُمْ - As provision for you and your livestock

---

## Vocabulary to Memorize

| Arabic | Transliteration | Meaning | Root |
|--------|-----------------|---------|------|
| النَّازِعَات | an-nāziʿāt | those who extract | ن ز ع |
| غَرْقًا | gharqan | with violence/deeply | غ ر ق |
| النَّاشِطَات | an-nāshiṭāt | those who remove | ن ش ط |
| السَّابِحَات | as-sābiḥāt | those who glide/swim | س ب ح |
| الرَّاجِفَة | ar-rājifah | the quaking/shaking | ر ج ف |
| الرَّادِفَة | ar-rādifah | the subsequent one | ر د ف |
| وَاجِفَة | wājifah | trembling | و ج ف |
| خَاشِعَة | khāshiʿah | humbled | خ ش ع |
| طَغَىٰ | ṭaghā | he transgressed | ط غ ي |
| تَزَكَّىٰ | tazakkā | to purify oneself | ز ك ي |
| دَحَاهَا | daḥāhā | He spread it out | د ح و |
| أَرْسَاهَا | arsāhā | He set firmly | ر س و |
| مَرْعَى | marʿā | pasture | ر ع ي |
| أَنْعَام | anʿām | livestock/cattle | ن ع م |
| مَتَاع | matāʿ | provision/enjoyment | م ت ع |

---

## Key Sentences from the Surah

**Sentence 1: The Opening Oath**
\`\`\`
وَالنَّازِعَاتِ غَرْقًا
\`\`\`
*wan-nāziʿāti gharqā* — By those [angels] who extract with violence

**Sentence 2: Allah's Command to Musa**
\`\`\`
اذْهَبْ إِلَىٰ فِرْعَوْنَ إِنَّهُ طَغَىٰ
\`\`\`
*idhab ilā firʿawna innahu ṭaghā* — Go to Fir'awn. Indeed, he has transgressed.

**Sentence 3: Fir'awn's Arrogant Claim**
\`\`\`
فَقَالَ أَنَا رَبُّكُمُ الْأَعْلَىٰ
\`\`\`
*faqāla ana rabbukumu al-aʿlā* — And said, "I am your lord, most high."

**Sentence 4: The Final Verse Covered**
\`\`\`
مَتَاعًا لَّكُمْ وَلِأَنْعَامِكُمْ
\`\`\`
*matāʿan lakum wa li-anʿāmikum* — As provision for you and your grazing livestock.

---

## Grammar Focus

### The Oath Structure (القَسَم)
- The surah opens with وَ (wa) + noun in the genitive case
- This is a common Quranic oath structure
- Example: وَالنَّازِعَاتِ (By the extractors)

### The Verb طَغَىٰ (to transgress)
- Root: ط غ ي
- Form I hollow verb
- Meaning: to exceed bounds, to transgress, to rebel
- Used for Fir'awn's rebellion against Allah

### The Verb دَحَا (to spread out)
- Root: د ح و  
- دَحَاهَا = He spread it (referring to the earth)
- Shows Allah's power in creation

---

## Teacher Notes

**Session Highlights:**
- Student read ayahs 1-33 of Surah An-Nazi'at
- Focus on understanding the themes: angels, resurrection, Musa & Fir'awn, creation
- Emphasis on key vocabulary for Quranic comprehension

**Points to Remember:**
1. The contrast between how angels take souls of believers vs disbelievers
2. Fir'awn's transgression (طغى) as the ultimate arrogance
3. Allah's rhetorical question about creation shows His power
4. All provision (متاع) comes from Allah for humans and animals

---

## Homework

### For Next Session:
1. **Memorization**: Memorize ayahs 1-5 with their meanings
2. **Vocabulary**: Learn all 15 vocabulary words in the table
3. **Ayah Quiz**: Practice matching English meanings to Arabic ayahs
4. **Reflection**: Write 3 lessons you learned from the story of Musa and Fir'awn
5. **Reading**: Read ayahs 34-46 (remainder of the surah) in preparation

---

## Key Takeaways

1. **Angels have specific duties** — extracting souls, racing to fulfill commands, managing affairs
2. **Fir'awn's arrogance** led to his destruction — claiming to be "the highest lord"
3. **Allah's creation** of the heavens and earth is far greater than creating humans
4. **Everything is provision** — Allah provides for both humans and their livestock
5. **The Day of Resurrection** is certain — hearts will tremble, eyes will be humbled`;

const updateData = {
  title: "Surah An-Nazi'at (79) - Ayahs 1-33",
  summary: "Studied Surah An-Nazi'at, covering the oaths about angels extracting souls, the story of Musa (AS) confronting Fir'awn and his arrogance, and Allah's creation of the heavens, earth, and provision for mankind and livestock.",
  key_topics: [
    "Angels and soul extraction",
    "Story of Musa and Fir'awn",
    "Fir'awn's transgression (طغى)",
    "Day of Resurrection",
    "Allah's creation and provision"
  ],
  areas_of_strength: [
    "Reading fluency",
    "Engagement with tafsir",
    "Vocabulary recognition"
  ],
  areas_for_improvement: [
    "Memorize key vocabulary",
    "Practice ayah recognition",
    "Deepen understanding of grammar structures"
  ],
  recommendations: [
    "Memorize ayahs 1-5 with meanings",
    "Review the 15 vocabulary words daily",
    "Practice the ayah matching quiz",
    "Prepare ayahs 34-46 for next session"
  ],
  detailed_insights: {
    content: detailedContent,
    metadata: {
      generated_at: new Date().toISOString(),
      source: "lesson_transcript",
      model: "transcript_analysis",
      lesson_date: "2025-11-30",
      teacher: "Osama Muhammad",
      student: "Nathan Fontaine",
      duration_minutes: 45,
      subject: "Quran with Understanding",
      surah_name: "An-Nazi'at",
      surah_number: 79,
      ayah_range: "1-33",
      topics_covered: ["angels", "musa_firaun", "resurrection", "creation", "provision"]
    }
  },
  student_participation_score: 90,
  ai_model: "transcript_analysis",
  confidence_score: 0.95
};

async function updateInsight() {
  console.log('Updating with Surah An-Nazi\'at content...');
  
  const { data, error } = await supabase
    .from('lesson_insights')
    .update(updateData)
    .eq('id', insightId)
    .select('id, title, summary, key_topics');

  if (error) {
    console.error('Error:', error);
    return;
  }

  console.log('✅ Surah An-Nazi\'at lesson insight created!');
  console.log(JSON.stringify(data, null, 2));
}

updateInsight();
